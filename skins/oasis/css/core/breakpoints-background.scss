@import 'skins/shared/color';
@import 'breakpoints-variables';
@import 'skins/shared/mixins/calc';

$background-height: get_command_line_param('background-image-height', 0);
$background-width: get_command_line_param('background-image-width', 0);
$gradient-width: 40px;
$adskin-width: 170px;
//@TODO clean up when cleaning up backgrounds
//In order to preserve compatibility between "old" responsive and "new" breakpoints
//We need to shift the background by 17px on each side, it comes from this equation:
//(1064 - 1030) / 2 = 17 (difference between content width for breakpoints and responsive)
$legacy-background-shift: 17px;
$legacy-background-shift-both-sides: $legacy-background-shift * 2;
$large-breakpoint-content-and-adskin-width: $content-width-large + 2 * $adskin-width;

// convert unitless int values to pixels
@if unitless($background-height) {
	$background-height : $background-height * 1px;
}
@if unitless($background-width) {
	$background-width : $background-width * 1px;
}

$background-width-half: $background-width / 2;
$background-offset: ($breakpoint-upper - $background-width) / 2;
$background-align: if($background-width > $width-outside, center, left);
$gradient-offset: $legacy-background-shift + $gradient-width;

@mixin breakpoint-middle-gradient($side) {
	background: rgba($color-body-middle, 0) linear-gradient(to #{$side}, rgba($color-body-middle, 0) 0%, $color-body-middle 100%);
}

@mixin background-max() {
	$background-margin: ($content-width-medium / 2) - (($content-width-large / 2) + $background-width-half + $legacy-background-shift);
	$background-halves-spacing: $content-width-large - $content-width-medium + $legacy-background-shift-both-sides;
	$gradient-offset: ($background-halves-spacing / 2) + $gradient-width;

	body.background-dynamic.skin-oasis {
		&::after,
		&::before {
			width: $background-width-half;
		}

		&:after {
			background-position: -$background-width-half 0;
			margin-right: $background-margin;
			right: 50%;
		}

		&::before {
			background-position: 0;
			left: 50%;
			margin-left: $background-margin;
		}

		.background-image-gradient {
			margin-left: -($background-halves-spacing / 2);
			width: $background-halves-spacing;

			&::after {
				@include calc('right', '50% - #{$gradient-offset}');
			}

			&::before {
				@include calc('left', '50% - #{$gradient-offset}');
			}
		}
	}
}

body {
	background: $color-body url($background-image) top $background-align repeat; /* $wgCdnStylePath */

	&.background-not-tiled {
		background-repeat: no-repeat;
	}

	&.background-fixed {
		 background-attachment: fixed;
	}
}

@if ($widthType == 0) {
	body.background-dynamic.skin-oasis {
		background: $color-body;
		overflow: hidden;
		position: relative;

		&::after,
		&::before {
			background-image: url($background-image); /* $wgCdnStylePath */
			background-repeat: no-repeat;
			content: '';
			height: $background-height;
			position: absolute;
			top: 0;
			width: $background-width-half;
			z-index: -1;
		}

		&.background-fixed::after,
		&.background-fixed::before {
			position: fixed;
		}

		&::after {
			@include calc('right', '50% - #{$legacy-background-shift}');
			background-position: -$background-width-half 0;
			margin-right: -$background-width-half;
		}

		&::before {
			// The extra 0.1% fixes sub-pixel rendering issues in Safari (DAR-1052)
			left: calc(50.1% - #{$legacy-background-shift});
			margin-left: -$background-width-half;
		}

		.background-image-gradient {
			background: $color-body-middle;
			left: 50%;
			margin-left: -#{$legacy-background-shift};
			width: $legacy-background-shift-both-sides;

			&,
			&::before,
			&::after {
				content: '';
				height: 100%;
				position: fixed;
				top: 0;
			}

			&::before,
			&::after {
				width: $gradient-width;
			}

			&::after {
				@include breakpoint-middle-gradient('left');
				@include calc('right', '50% - #{$gradient-offset}');
			}

			&::before {
				@include breakpoint-middle-gradient('right');
				@include calc('left', '50% - #{$gradient-offset}');
			}
		}
	}

	@media #{$breakpoint-small-only} {
		body.skin-oasis {
			background-image: none;

			&::after,
			&::before {
				display: none;
			}

			.background-image-gradient {
				display: none;
			}
		}
	}

	@media screen and (min-width: $large-breakpoint-content-and-adskin-width) {
		@include background-max;
	}
}
